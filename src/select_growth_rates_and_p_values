#!/usr/bin/env bash
#
DATA_FILE=${1}
TABLE_NAME=$(basename "${DATA_FILE}" .csv)
P_VALUE_COLUMN=${2}
CONDITIONAL=${3}
csvsql --snifflimit 0 --no-inference --blanks --query "
SELECT 
  Islet AS 'Archipelago/Island',
  Growth_rate AS 'Growth rate',
  CASE
    WHEN ${P_VALUE_COLUMN} < 0.001
    THEN '$<0.001$'
    ELSE ${P_VALUE_COLUMN}
  END 'p-value'
FROM ${TABLE_NAME}
WHERE ${P_VALUE_COLUMN} ${CONDITIONAL} \
" ${DATA_FILE}